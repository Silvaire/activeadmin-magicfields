# Define the Part Object
part_objects = resource.part_objects.build

# parents_array = params[:form_name].split("[").map{|n| n.chomp(']')}

# raise

# Build the form
active_admin_form_for part, url: "to_be_stripped" do |f| 
  f.semantic_fields_for :part_objects do |part_object|

    part_object.input :part_id, as: :hidden, input_html: {value: part.id}

    resource.field_templates.each_with_index do |field_template, ix|
      part_object.semantic_fields_for "part_object_fields_attributes[#{ix}]", part_objects.part_object_fields.build do |part_object_field|


        field_object = Field.const_get(field_template.field_type.classify).new

        part_object_field.semantic_fields_for  "fieldable_attributes", field_object do |field|
          part_object.inputs do
            field.input field_template.field_type, label: field_template.title, required: field_template.is_required
            field.input :fieldable_type, as: :hidden, input_html: {value: field_template.field_type.classify}
            field.input :title, as: :hidden, input_html: {value: field_template.title}
          end

        end
      end
    end
  end
end

